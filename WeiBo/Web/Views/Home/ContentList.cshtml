@{
    Layout = null;
    var vList = Model as List<Web.ViewModels.VMContent>;
}

<script>
    var count = '@vList.Count';

    for (var i = 0; i < count; i++) {
        $('#editor_' + i).html($('#heditor_' + i).val());
    }
</script>

<script>
    $('#editor_0').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_1').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_2').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_3').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_4').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_5').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_6').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_7').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_8').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
    $('#editor_9').trumbowyg({
        lang: 'zh_cn',
        btnsDef: {
            image: {
                dropdown: ['insertImage', 'base64'],
                ico: 'insertImage'
            }
        },
        btns: ['image']
    });
</script>

<script>
    function Clear(index) {
        if (confirm('确定清空内容吗？')) {
            $('#editor_' + index).html('');
            $('#picfile').val('');
        }
    }

    function Save(index) {
        //var str = editor[index].text();
        //var str = editor[index].html();

        //str = str.replace(/[<>&"']/g, function (c) {
        //    return { '<': '&lt;', '>': '&gt;', '&': '&amp;', '"': '&quot;', "'": '&apos;' }[c];
        //});

        //$('#Conten_' + index).val(str);

        //var formData = new FormData();
        //formData.append("ArticleID", $('#ArticleID_' + index).val());
        //formData.append("DomainID", $('#DomainID_' + index).val());
        //formData.append("Conten", $('#Conten_' + index).val());

        //$.ajax({
        //    url: '/Home/SaveContents',
        //    type: 'post',
        //    data: formData,
        //    contentType: false,
        //    processData: false,
        //    success: function (data) {

        //    },
        //    error: function () {
        //        alert();
        //    }
        //})
    }
</script>

<script>
    var state = 0;
    var vstate = 0;

    function UploadFile(index) {
        $('#picfile').click();
        state = index;
    }

    $('#picfile').change(function (e) {
        var file = e.delegateTarget.files[0];
        if (file == null) { return; }
        var status = Verify(file);
        if (status == false) { $('#picfile').val(''); alert('请上传 JPG、JPEG、PNG、GIF 格式的图片文件'); return; }

        var reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function (ret) {
            var picString = reader.result;
            editor[state].insertHtml('<img src="' + picString + '" />');
        }
    });

    function GetVideo(articleid, index) {
        //$.ajax({
        //    url: '/Home/DownLoadVideo',
        //    type: "post",
        //    success: function (data) {
        //        alert(data);
        //    }
        //})

        //vstate = index;

        $('#upv').show();
        $('#videoid').val(index);

        $.ajax({
            url: '/Home/ShowVideo',
            type: "post",
            data: {
                articleID: articleid
            },
            success: function (data) {
                $('#vcontent').html(data);
            }
        })
    }

    $('#videofile').change(function (e) {
        var file = e.delegateTarget.files[0];
        if (file == null) { return; }

        var index = file.name.lastIndexOf(".");
        var ext = file.name.substr(index + 1);
        ext = ext.toUpperCase();

        if (ext != "MP4") { $('#videofile').val(''); alert('请上传MP4格式的视频'); return; }

        var reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = function (ret) {
            var videoStr = reader.result;
            editor[vstate].insertHtml('<video controls style="width:430px;" preload="auto" autoplay="autoplay" src="' + videoStr + '"></video>');
        }
    });

    var arr = ["JPG", "JPEG", "PNG", "GIF"];

    function Verify(file) {
        var statu = false;

        var index = file.name.lastIndexOf(".");
        var ext = file.name.substr(index + 1);
        ext = ext.toUpperCase();

        for (var i = 0; i < arr.length; i++) {
            if (ext == arr[i]) {
                statu = true;
            }
        }
        return statu;
    }
</script>

<link href="~/Content/trumbowyg/design/css/trumbowyg.css" rel="stylesheet" />

<input hidden="hidden" id="picfile" type="file" />
<input hidden="hidden" id="videofile" type="file" />

<ul class="dropdown-menu">
    @for (int i = 0; i < vList.Count; i++)
    {
        <li class="Board" style="height:auto;">
            <form id="f_@i">
                <input id="ArticleID_@i" name="ArticleID" type="hidden" value="@vList[i].ArticleID" />
                <input id="DomainID_@i" name="DomainID" type="hidden" value="@vList[i].DomainID" />
                <input id="Conten_@i" name="Conten" type="hidden" value="" />
            </form>
            <div id="editor_@i" class="editor">
                <input type="hidden" id="heditor_@i" value="@vList[i].Conten" />
            </div>
            <div style="padding:5px 0 5px 0;">
                @*<button onclick="window.location.href='/Home/DLVideo'">Test</button>*@
                @*<button onclick="GetVideo('@vList[i].ArticleID', '@i')">视频</button>*@
                <button onclick="Clear(@i)" name="clear">清空内容</button>
                <button onclick="Save(@i)" style="position:absolute;right:5px;width:68px;">保存</button>
            </div>
        </li>
    }

    <div>
        <button onclick="First()">首　页</button>
        <button onclick="Paging('Previous')">上一页</button>
        <span id="index"></span>
        <button onclick="Paging('Next')">下一页</button>
        <span id="total"></span>
        <input id="pcount" type="text" style="width:50px;height:23px;text-align:center;" />
        <button onclick="Jump()">跳转</button>
        <span id="error" style="color:red"></span>
    </div>
</ul>


